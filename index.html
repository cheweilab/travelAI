<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI æ—…éŠåŠ©ç†ï¼ˆå«å‹•æ…‹å¤©æ°£å¡ï¼‰</title>
<style>
  /* åŸºæœ¬é é¢ */
  :root{
    --bg:#0f1724;
    --panel-bg: rgba(255,255,255,0.06);
    --glass: rgba(255,255,255,0.07);
  }
  body{ margin:0; font-family: "Segoe UI", Roboto, "Noto Sans TC", sans-serif; background:var(--bg); color:#fff; }

  /* chat widget container */
  .chat-widget { position:fixed; right:20px; bottom:20px; z-index:9999; display:flex; flex-direction:column; align-items:flex-end; gap:10px; }
  .chat-btn { background:linear-gradient(135deg,#ffcc70,#ff7eb3); border:none; border-radius:50px; padding:12px 18px; font-weight:700; font-size:15px; cursor:pointer; color:#111; box-shadow:0 8px 30px rgba(0,0,0,0.45); }
  .chat-panel { position:fixed; right:20px; bottom:80px; width:380px; max-width:92vw; background:var(--panel-bg); backdrop-filter: blur(12px) saturate(180%); border-radius:16px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.06); display:flex; flex-direction:column; opacity:0; transform:translateY(20px); pointer-events:none; visibility:hidden; transition:opacity .28s ease, transform .28s ease, visibility 0s linear .28s; }
  .chat-panel.open{ opacity:1; transform:translateY(0); pointer-events:auto; visibility:visible; transition:opacity .28s ease, transform .28s ease; }
  .chat-header { padding:12px 14px; display:flex; align-items:center; justify-content:space-between; background:rgba(0,0,0,0.25); border-bottom:1px solid rgba(255,255,255,0.03); }
  .brand{ font-weight:800; font-size:16px; letter-spacing:0.4px; }
  .desc{ font-size:12px; color:rgba(255,255,255,0.75); }
  .chat-area{ padding:14px; display:flex; flex-direction:column; gap:12px; min-height:220px; max-height:56vh; overflow-y:auto; box-sizing:border-box; }
  .bubble{ max-width:90%; padding:12px 14px; border-radius:16px; line-height:1.4; font-size:14px; box-shadow:0 6px 18px rgba(0,0,0,0.35); word-wrap:break-word; background:linear-gradient(135deg,#84fab0,#8fd3f4); color:#000; }
  .bubble.user{ align-self:flex-end; background:linear-gradient(135deg,#a8ff78,#78ffd6); color:#000; border-bottom-right-radius:6px; }
  .bubble.bot{ align-self:flex-start; background:linear-gradient(135deg,#ffffff11,#ffffff06); color:#fff; border-bottom-left-radius:6px; }
  .typing{ font-size:13px; color:rgba(255,255,255,0.85); padding-left:6px; }

  .quick-actions{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:6px; }
  .quick-btn{ background:rgba(255,255,255,0.1); border:none; border-radius:10px; padding:8px 12px; font-size:13px; cursor:pointer; color:#fff; }
  .chat-input-row{ display:flex; gap:8px; padding:12px; border-top:1px solid rgba(255,255,255,0.04); background:rgba(0,0,0,0.22); }
  #chatInput{ flex:1; min-height:42px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#fff; outline:none; resize:none; }
  #sendChatBtn{ padding:10px 14px; border-radius:12px; border:none; background:linear-gradient(135deg,#ffcc70,#ff7eb3); color:#111; font-weight:700; cursor:pointer; min-width:70px; }

  /* form bubble */
  .form-bubble{ background:linear-gradient(135deg,#ffffff10,#ffffff05); padding:12px; border-radius:14px; width:100%; box-sizing:border-box; }
  .form-bubble input,.form-bubble select{ padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background:transparent; color:#fff; font-size:13px; }

  /* --- Weather card bubble (æ•´åˆç‰ˆ) --- */
  .bubble.weather { padding:6px; background:transparent; box-shadow:none; border-radius:0; }
  .weather-bubble {
    display:flex;
    width:320px;
    max-width:92vw;
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 10px 28px rgba(0,0,0,0.5);
    border:1px solid rgba(255,255,255,0.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  }
  .weather-left {
    flex:1;
    padding:14px;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    color:#fff;
    background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.15));
  }
  .weather-time{ font-size:20px; font-weight:700; }
  .weather-location{ font-size:12px; opacity:0.9; margin-top:6px; }
  .weather-right {
    flex:1.2;
    padding:14px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    color:#fff;
    background-size:cover;
    background-position:center;
    position:relative;
  }
  .weather-temp{ font-size:28px; font-weight:700; margin-bottom:6px; text-shadow:0 4px 18px rgba(0,0,0,0.4);}
  .weather-status{ font-size:14px; opacity:0.96; margin-bottom:6px; text-shadow:0 4px 10px rgba(0,0,0,0.3); }
  .weather-extra{ font-size:12px; opacity:0.92; }
  .weather-icon { position:absolute; right:12px; top:10px; font-size:28px; opacity:0.95; text-shadow:0 6px 18px rgba(0,0,0,0.45); }

  /* small screen */
  @media (max-width:600px){
    .chat-panel{ right:8px; bottom:70px; width:calc(100% - 16px); border-radius:12px; }
    .weather-bubble{ width:100%; }
  }
</style>
</head>
<body>

<div class="chat-widget">
  <button class="chat-btn" id="chatToggle" aria-expanded="false" aria-controls="travelChatPanel">ğŸ’¬ æ—…éŠåŠ©ç†</button>

  <div class="chat-panel" id="travelChatPanel" role="dialog" aria-label="Travel Assistant" aria-modal="false">
    <div class="chat-header">
      <div>
        <div class="brand">AI æ—…éŠåŠ©ç† âœˆï¸</div>
        <div class="desc">å¯è©¢å•æ™¯é»ã€å« Uberã€è¡Œç¨‹å»ºè­°</div>
      </div>
      <div><button id="closeChatPanel" style="background:none;border:none;color:#fff;cursor:pointer;font-weight:700">âœ•</button></div>
    </div>

    <div class="chat-area" id="chatArea" aria-live="polite"></div>

    <div style="padding:0 12px 10px;">
      <div class="quick-actions" id="quickActions" role="toolbar" aria-label="Quick actions">
        <button class="quick-btn" data-msg="å»ºè­°æ™¯é»">å»ºè­°æ™¯é»</button>
        <button class="quick-btn" data-msg="å« Uber">å« Uber</button>
        <button class="quick-btn" data-msg="è¦åŠƒè¡Œç¨‹">è¦åŠƒè¡Œç¨‹</button>
        <button class="quick-btn" id="btnUseGeo">æˆ‘çš„ä½ç½®ï¼ˆGPSï¼‰</button>
        <button class="quick-btn" data-msg="æˆ‘çš„ä½ç½®">è¼¸å…¥åœ°å€</button>
      </div>

      <div class="chat-input-row">
        <textarea id="chatInput" placeholder="è¼¸å…¥æ‚¨çš„æ—…éŠå•é¡Œ..." aria-label="Message input"></textarea>
        <button id="sendChatBtn">å‚³é€</button>
      </div>
    </div>
  </div>
</div>

<script type="module">
/* =========================
   è¨­å®š â€” æŠŠé€™è£¡æ›æˆä½ çš„ Key
   è«‹å‹™å¿…åœ¨ GA Console å•Ÿç”¨ Weather API èˆ‡ Geocoding ä¸¦é™åˆ¶é‡‘é‘°
   ========================= */
const GOOGLE_API_KEY = "AIzaSyCk6dUdKEr5pjhPN1h8sB0EX7_HiDCMbAE";

/* -------------------------
   DOM refs
   ------------------------- */
const chatToggle = document.getElementById('chatToggle');
const chatPanel = document.getElementById('travelChatPanel');
const closeChatPanel = document.getElementById('closeChatPanel');
const chatArea = document.getElementById('chatArea');
const chatInput = document.getElementById('chatInput');
const sendChatBtn = document.getElementById('sendChatBtn');
const quickActions = document.getElementById('quickActions');
const btnUseGeo = document.getElementById('btnUseGeo');

/* -------------------------
   Panel toggles
   ------------------------- */
function openChat(){ chatPanel.classList.add('open'); chatToggle.setAttribute('aria-expanded','true'); chatInput.focus(); }
function closeChat(){ chatPanel.classList.remove('open'); chatToggle.setAttribute('aria-expanded','false'); }
chatToggle.addEventListener('click', ()=>{ chatPanel.classList.contains('open') ? closeChat() : openChat(); });
closeChatPanel.addEventListener('click', closeChat);

/* -------------------------
   Helpers
   ------------------------- */
function scrollToBottom(){ chatArea.scrollTop = chatArea.scrollHeight; }
function createBubble(who='bot'){ const div=document.createElement('div'); div.className='bubble '+(who==='user'?'user':'bot'); return div; }
function appendTextBubble(text, who='bot'){ const div=createBubble(who); div.textContent=text; chatArea.appendChild(div); scrollToBottom(); return div; }

/* -------------------------
   Travel AI / placeholder (æœ¬ç¯„ä¾‹æœƒç”¨å‡å›è¦†)
   ä½ å¯å°‡ travelBotAI æ”¹ç‚ºå‘¼å«å¾Œç«¯æˆ– OpenAI
   ------------------------- */
async function travelBotAI(userMessage, coords=null){
  // placeholder - å›å‚³ç°¡çŸ­å›è¦†
  return `æ”¶åˆ°ï¼šã€Œ${userMessage}ã€ã€‚æˆ‘å¯ä»¥å”åŠ©æ‚¨è¦åŠƒæˆ–æŸ¥è©¢å¤©æ°£ã€è·¯ç·šç­‰ã€‚`;
}

/* -------------------------
   Google Geocoding å‡½å¼ï¼ˆåœ°å€ -> åº§æ¨™ï¼‰
   ------------------------- */
async function getGeocodeJSON(address){
  try {
    const url = `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${GOOGLE_API_KEY}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error(`Geocode HTTP ${res.status}`);
    const data = await res.json();
    return data;
  } catch(err){
    console.error("Geocode error:", err);
    return null;
  }
}

/* -------------------------
   WeatherAPI.com - å–å¾—å¤©æ°£è³‡æ–™
   ------------------------- */
async function fetchWeather(latitude, longitude) {
  const APIKEY = "73027c13be03423c80d61237251111";
  const q = `${latitude},${longitude}`;
  const url = `https://api.weatherapi.com/v1/current.json?key=${APIKEY}&q=${encodeURIComponent(q)}&aqi=no`;

  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`WeatherAPI HTTP ${res.status}`);

    const data = await res.json();
    const current = data.current;

    return {
      raw: data,
      description: current.condition.text,
      temperature: current.temp_c,
      feelsLike: current.feelslike_c,
      humidity: current.humidity,
      wind: `${current.wind_kph} kph`,
      windDir: current.wind_dir
    };
  } catch (err) {
    console.error("Weather fetch error:", err);
    return { error: true, message: err.message || String(err) };
  }
}

/* -------------------------
   Weather èƒŒæ™¯æ˜ å°„ï¼ˆé—œéµå­— â†’ åœ–ç‰‡/Emojiï¼‰
   é€™è£¡ä½¿ç”¨ä¸€äº›å…¬é–‹åœ–ç¤º URLï¼ˆå¯è‡ªè¡Œæ›¿æ›ï¼‰
   ------------------------- */
const WEATHER_BG = {
  clear: {
    img: "https://images.unsplash.com/photo-1502082553048-f009c37129b9?auto=format&fit=crop&w=1200&q=60",
    emoji: "â˜€ï¸"
  },
  sunny: {
    img: "https://images.unsplash.com/photo-1501973801540-537f08ccae7b?auto=format&fit=crop&w=1200&q=60",
    emoji: "â˜€ï¸"
  },
  cloudy: {
    img: "https://images.unsplash.com/photo-1501975558163-34a7f6e7f3f1?auto=format&fit=crop&w=1200&q=60",
    emoji: "ğŸŒ¥ï¸"
  },
  rain: {
    img: "https://images.unsplash.com/photo-1499346030926-9a72daac6c63?auto=format&fit=crop&w=1200&q=60",
    emoji: "ğŸŒ§ï¸"
  },
  snow: {
    img: "https://images.unsplash.com/photo-1482192596544-9eb780fc7f66?auto=format&fit=crop&w=1200&q=60",
    emoji: "â„ï¸"
  },
  fog: {
    img: "https://images.unsplash.com/photo-1502082553048-2672c00a3f85?auto=format&fit=crop&w=1200&q=60",
    emoji: "ğŸŒ«ï¸"
  },
  default: {
    img: "https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=1200&q=60",
    emoji: "ğŸŒ¤ï¸"
  }
};

/* æ ¹æ“šæè¿°æ–‡å­—åˆ¤å®š key */
function mapConditionToKey(desc){
  if(!desc) return "default";
  const s = String(desc).toLowerCase();
  if(s.includes("clear") || s.includes("sun") || s.includes("æ™´") ) return "clear";
  if(s.includes("sun") || s.includes("sunny")) return "sunny";
  if(s.includes("cloud") || s.includes("overcast") || s.includes("å¤šé›²") ) return "cloudy";
  if(s.includes("rain") || s.includes("drizzle") || s.includes("é›¨") ) return "rain";
  if(s.includes("snow") || s.includes("é›ª")) return "snow";
  if(s.includes("fog") || s.includes("mist") || s.includes("haze") || s.includes("éœ§") ) return "fog";
  return "default";
}

/* -------------------------
   å°‡å¤©æ°£å¡åŠ å…¥èŠå¤©å€åŸŸï¼ˆæ•´åˆç‰ˆï¼‰
   data: {formattedAddress, weatherResult}
   ------------------------- */
function appendWeatherBubble({ formattedAddress, weatherResult }) {
  const bubble = document.createElement('div');
  bubble.className = 'bubble bot weather';

  const card = document.createElement('div');
  card.className = 'weather-bubble';

  const descKey = mapConditionToKey(weatherResult.description);
  const bg = WEATHER_BG[descKey] ?? WEATHER_BG.default;

  // æ™‚é–“èˆ‡æ—¥æœŸï¼ˆä½¿ç”¨ä½¿ç”¨è€…æ™‚å€ï¼‰
  const now = new Date();
  const timeLabel = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
  const dateLabel = now.toLocaleDateString('zh-TW', { month: 'short', day: 'numeric', weekday: 'short' });

  card.innerHTML = `
    <div class="weather-left">
      <div>
        <div class="weather-time">${timeLabel}</div>
        <div class="weather-location">${formattedAddress}<br><span style="opacity:0.9">${dateLabel}</span></div>
      </div>
      <div style="opacity:0.95; font-size:14px; margin-top:6px;">AI æ—…éŠåŠ©ç†</div>
    </div>

    <div class="weather-right" style="background-image:url('${bg.img}')">
      <div class="weather-temp">${weatherResult.temperature}Â°</div>
      <div class="weather-status">${bg.emoji} ${weatherResult.description}</div>
      <div class="weather-extra">é«”æ„Ÿï¼š${weatherResult.feelsLike}Â° â€¢ æ¿•åº¦ï¼š${weatherResult.humidity}% â€¢ é¢¨ï¼š${weatherResult.wind} ${weatherResult.windDir ?? ''}</div>
      <div class="weather-icon">${bg.emoji}</div>
    </div>
  `;

  bubble.appendChild(card);
  chatArea.appendChild(bubble);
  scrollToBottom();
}

/* -------------------------
   Address form bubbleï¼ˆèˆ‡ä½ åŸæœ¬çš„æµç¨‹æ•´åˆï¼‰
   ------------------------- */
function appendAddressFormBubble() {
  const bubble = createBubble('bot');
  const wrapper = document.createElement('div');
  wrapper.className = 'form-bubble';
  wrapper.innerHTML = `
    <form id="addressForm">
      <label for="userAddress">è«‹è¼¸å…¥æ‚¨çš„åœ°å€</label>
      <input id="userAddress" type="text" placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚å¤§åŒå€å¯§å¤è·¯" required />
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px;">
        <button type="button" class="btn-ghost" id="cancelAddressForm" style="background:none;border:1px solid rgba(255,255,255,0.08);padding:6px 10px;border-radius:8px;color:#fff;">å–æ¶ˆ</button>
        <button type="submit" class="btn-primary" style="padding:6px 10px;border-radius:8px;border:none;font-weight:700;">é€å‡º</button>
      </div>
    </form>
  `;
  bubble.appendChild(wrapper);
  chatArea.appendChild(bubble);
  scrollToBottom();

  const form = wrapper.querySelector('#addressForm');
  const cancelBtn = wrapper.querySelector('#cancelAddressForm');
  const input = wrapper.querySelector('#userAddress');
  input.focus();

  cancelBtn.addEventListener('click', () => bubble.remove());

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const address = input.value.trim();
    if(!address) return;
    bubble.remove();

    appendTextBubble('æ‚¨ï¼šæˆ‘çš„ä½ç½®æ˜¯ ' + address, 'user');
    const typing = appendTextBubble('æ—…éŠåŠ©ç†æ­£åœ¨æŸ¥è©¢æ‚¨çš„åº§æ¨™...', 'bot');

    const result = await getGeocodeJSON(address);
    typing.remove();

    if(result && result.status === 'OK' && result.results && result.results.length>0){
      const geo = result.results[0].geometry.location;
      const formatted = result.results[0].formatted_address;
      localStorage.setItem('userAddress', formatted);
      localStorage.setItem('userCoords', JSON.stringify({ latitude: geo.lat, longitude: geo.lng }));

      appendTextBubble(`æ—…éŠåŠ©ç†ï¼šå·²æ‰¾åˆ°åœ°å€ã€Œ${formatted}ã€ï¼Œç·¯åº¦ ${geo.lat}ï¼Œç¶“åº¦ ${geo.lng}`, 'bot');

      // å–å¾—å¤©æ°£ä¸¦é¡¯ç¤ºå¤©æ°£å¡
      const weatherRes = await fetchWeather(geo.lat, geo.lng);
      if(weatherRes?.error){
        appendTextBubble(`æŠ±æ­‰ï¼Œç„¡æ³•å–å¾—å¤©æ°£ï¼š${weatherRes.message}`, 'bot');
      } else {
        appendWeatherBubble({ formattedAddress: formatted, weatherResult: weatherRes });
      }

    } else {
      appendTextBubble('æ—…éŠåŠ©ç†ï¼šæŠ±æ­‰ï¼Œç„¡æ³•æ‰¾åˆ°è©²åœ°å€çš„åº§æ¨™ï¼Œè«‹ç¢ºèªåœ°å€æ˜¯å¦æ­£ç¢ºã€‚', 'bot');
    }
  });
}

/* -------------------------
   ä½¿ç”¨ç€è¦½å™¨ GPS å–å¾—ä½ç½®ä¸¦é¡¯ç¤ºå¤©æ°£
   ------------------------- */
btnUseGeo.addEventListener('click', ()=> {
  appendTextBubble('æ‚¨ï¼šä½¿ç”¨ GPS å®šä½', 'user');
  appendTextBubble('æ—…éŠåŠ©ç†ï¼šæ­£åœ¨å˜—è©¦å–å¾—æ‚¨çš„ä½ç½®ï¼ˆéœ€è¦æ‚¨çš„å…è¨±ï¼‰', 'bot');

  if(!navigator.geolocation){
    appendTextBubble('ç€è¦½å™¨ä¸æ”¯æ´åœ°ç†å®šä½ã€‚', 'bot');
    return;
  }

  navigator.geolocation.getCurrentPosition(async (pos)=>{
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    // åå‘åœ°ç†ç·¨ç¢¼ï¼ˆç°¡å–®é¡¯ç¤ºç¶“ç·¯åº¦ç‚ºä½ç½®ï¼‰
    const formatted = `ç·¯åº¦ ${lat.toFixed(5)}, ç¶“åº¦ ${lng.toFixed(5)}`;
    localStorage.setItem('userCoords', JSON.stringify({ latitude: lat, longitude: lng}));
    localStorage.setItem('userAddress', formatted);

    appendTextBubble(`æ—…éŠåŠ©ç†ï¼šå–å¾—æ‚¨çš„åº§æ¨™ ${formatted}`, 'bot');

    const weatherRes = await fetchWeather(lat, lng);
    if(weatherRes?.error){
      appendTextBubble(`æŠ±æ­‰ï¼Œç„¡æ³•å–å¾—å¤©æ°£ï¼š${weatherRes.message}`, 'bot');
    } else {
      appendWeatherBubble({ formattedAddress: formatted, weatherResult: weatherRes });
    }
  }, (err)=>{
    console.error("geo error", err);
    appendTextBubble('æ—…éŠåŠ©ç†ï¼šç„¡æ³•å–å¾— GPS ä½ç½®ï¼ˆä½¿ç”¨è€…æ‹’çµ•æˆ–è£ç½®ä¸æ”¯æ´ï¼‰ã€‚', 'bot');
  }, { enableHighAccuracy: false, timeout: 10000 });
});

/* -------------------------
   Itinerary formï¼ˆç°¡åŒ–ï¼‰
   ------------------------- */
function appendItineraryFormBubble(){
  const existing = chatArea.querySelector('.form-bubble'); if(existing) existing.closest('.bubble').remove();
  const bubble = createBubble('bot');
  const wrapper = document.createElement('div'); wrapper.className='form-bubble';
  wrapper.innerHTML = `<form id="itineraryForm">
    <label for="dest">ç›®çš„åœ°</label>
    <input id="dest" name="dest" type="text" placeholder="åŸå¸‚æˆ–æ™¯é»" required />
    <div style="display:flex;gap:8px;margin-top:8px;">
      <input id="startDate" type="date" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);"/>
      <input id="days" type="number" min="1" value="2" style="width:80px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);"/>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px;">
      <button type="button" id="cancelForm" style="background:none;border:1px solid rgba(255,255,255,0.06);padding:6px 10px;border-radius:8px;color:#fff;">å–æ¶ˆ</button>
      <button type="submit" style="padding:6px 10px;border-radius:8px;border:none;font-weight:700;">é–‹å§‹è¦åŠƒ</button>
    </div>
  </form>`;
  bubble.appendChild(wrapper); chatArea.appendChild(bubble); scrollToBottom();
  wrapper.querySelector('#dest').focus();
  wrapper.querySelector('#cancelForm').addEventListener('click', ()=>bubble.remove());
  wrapper.querySelector('form').addEventListener('submit', async e=>{
    e.preventDefault();
    const f=e.target;
    const dest=f.dest.value.trim();
    if(!dest){ f.dest.focus(); return; }
    bubble.remove();
    appendTextBubble(`æ‚¨ï¼šæƒ³å» ${dest}ï¼Œå‡ºç™¼æ—¥æœŸ ${f.startDate.value || 'æœªæŒ‡å®š'}ï¼Œ${f.days.value} å¤©`, 'user');
    const typing = appendTextBubble('æ—…éŠåŠ©ç†æ­£åœ¨ç‚ºæ‚¨è¦åŠƒè¡Œç¨‹...', 'bot');
    const reply = await travelBotAI(`è¦åŠƒ ${dest} è¡Œç¨‹`); // å¯æ”¹ç‚ºå¯¦éš›çš„ AI ä¸²æ¥
    typing.remove();
    appendTextBubble('æ—…éŠåŠ©ç†ï¼š' + reply, 'bot');
  });
}

/* -------------------------
   Quick actions
   ------------------------- */
quickActions.addEventListener('click', e=>{
  const btn = e.target.closest('.quick-btn');
  if(!btn) return;
  const action = btn.dataset?.msg;
  if(action === 'è¦åŠƒè¡Œç¨‹'){ appendItineraryFormBubble(); return; }
  if(action === 'æˆ‘çš„ä½ç½®'){ appendAddressFormBubble(); return; }
  if(action === 'å« Uber'){ appendTextBubble('æ‚¨ï¼šå« Uber', 'user'); appendTextBubble('æ—…éŠåŠ©ç†ï¼šæŠ±æ­‰ï¼Œç¤ºç¯„ç‰ˆå°šæœªä¸²æ¥ Uber APIã€‚', 'bot'); return; }
  if(action === 'å»ºè­°æ™¯é»'){ appendTextBubble('æ‚¨ï¼šå»ºè­°æ™¯é»', 'user'); appendTextBubble('æ—…éŠåŠ©ç†ï¼šæ‚¨æƒ³è¦å“ªå€‹åŸå¸‚æˆ–é¢¨æ ¼çš„æ™¯é»ï¼Ÿ', 'bot'); return; }
});

/* -------------------------
   Send message
   ------------------------- */
async function sendUserMessage(text){
  appendTextBubble('æ‚¨ï¼š'+text,'user');
  chatInput.value='';
  const typing = appendTextBubble('æ—…éŠåŠ©ç†æ­£åœ¨è¼¸å…¥...','bot');
  const reply = await travelBotAI(text);
  typing.remove();
  appendTextBubble('æ—…éŠåŠ©ç†ï¼š'+reply,'bot');
}

sendChatBtn.addEventListener('click', ()=>{ const t=chatInput.value.trim(); if(t) sendUserMessage(t); });
chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendChatBtn.click(); } });

/* -------------------------
   åˆå§‹å•å€™
   ------------------------- */
appendTextBubble("æ—…éŠåŠ©ç†ï¼šæ‚¨å¥½ï¼æˆ‘å¯ä»¥å”åŠ©æ‚¨æŸ¥è©¢æ™¯é»ã€å« Uberã€è¦åŠƒè¡Œç¨‹ï¼Œæˆ–è¼¸å…¥/ä½¿ç”¨æ‚¨çš„ä½ç½®ä»¥ç²å–åº§æ¨™èˆ‡å¤©æ°£ã€‚",'bot');

</script>
</body>
</html>
